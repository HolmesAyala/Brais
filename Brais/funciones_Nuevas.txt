-- FUNCTION: usuario.f_buscar_paciente(text)

-- DROP FUNCTION usuario.f_buscar_paciente(text);

CREATE OR REPLACE FUNCTION usuario.f_buscar_pacientes_agendados(
	_id_medico text)
    RETURNS SETOF usuario.view_obtener_paciente_medico 
    LANGUAGE 'plpgsql'

    COST 100
    VOLATILE 
    ROWS 1000
AS $BODY$

BEGIN 
	RETURN QUERY
		SELECT 
			usuario.cita.hora_inicio, 
			usuario.tipo_identificacion.nombre,
			usuario.usuario.identificacion, 
			usuario.usuario.nombre, 
			usuario.usuario.apellido
		FROM 
			usuario.usuario, usuario.cita, usuario.tipo_identificacion
		WHERE 
			usuario.usuario.tipo = 3 and usuario.usuario.identificacion = usuario.cita.id_usuario and 
			usuario.cita.id_medico = _id_medico and
			usuario.tipo_identificacion.id = usuario.usuario.id_tipo_identificacion
		ORDER BY usuario.cita.id_usuario;
END

$BODY$;

ALTER FUNCTION usuario.f_buscar_pacientes_agendados(text)
    OWNER TO postgres;


select * from usuario.f_buscar_pacientes_agendados('10922')



